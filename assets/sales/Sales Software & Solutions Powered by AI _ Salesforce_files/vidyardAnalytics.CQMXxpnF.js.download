import{r as e,f as t,a as i,b as a,L as r,d as s}from"./chunks/helpers.v55IkvxL.js";import{V as d}from"./chunks/v4.umd.DeoxNscK.js";import"./chunks/_commonjsHelpers.CXUWDbkB.js";function o(e,t,i,a){const{h:r}=e;return[r("span",{attrs:{"data-id":t.videoUuid},key:0})]}var n=e(o);function c(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function v(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?c(Object(i),!0).forEach((function(t){l(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}o.stylesheets=[],o.stylesheetToken="lwc-1ak14pj03rc",o.legacyStylesheetToken="pbc-vidyardAnalytics_vidyardAnalytics",t(o);class h extends r{constructor(...e){super(...e),this.videoUuid=void 0,this.liveVideo=void 0,this.playerList=[],this.currentUuid="",this.initialPlayEventFired=!1,this.initialLoadEventFired=!1,this.heartbeatInterval=null,this.videoAction="",this.videoPlays=0,this.videoLoads=0,this.videoPercentageWatched="",this.videoSecondsWatched=0,this.playerType="video",this.chapterId="",this.playerUuid="",this.chapters=[],this.chapterName=""}renderedCallback(){this.currentUuid!==this.videoUuid&&(this.currentUuid=this.videoUuid,this.initialPlayEventFired=!1,this.initialLoadEventFired=!1),this.liveVideo&&(this.playerType="live video"),d.api?.addReadyListener(((e,t)=>{const i=t.metadata;i&&(this.chapters=i.chapters_attributes.map((function(e){return e.video_attributes}))),t.on("ready",(()=>{this.initialLoadEventFired||(this.chapters.length>1&&(this.playerType="video playlist",this.firePbcVideoEvent("custEv_videoPlaylist",t)),this.chapters.forEach((e=>{this.chapterName=e.name,this.videoUuid=this.getChapterVideoId(e),this.videoLoads+=1,this.firePbcVideoEvent("custEv_videoLoad",t)})),this.initialLoadEventFired=!0)})),t.on("play",(()=>{if(t.element.getRootNode().host!==this.template.host.closest("pbc-vidyard-player"))return;this.liveVideo&&this.scheduleHeartbeatEvent(t);const e=t.status.chapterIndex,a=i.chapters_attributes[e]?.video_attributes;a&&(this.chapterName=a.name,this.videoUuid=this.getChapterVideoId(a)),this.initialPlayEventFired||(this.videoPlays=1,this.videoAction="Play",this.firePbcVideoEvent("custEv_videoPlay",t),this.initialPlayEventFired=!0,this.liveVideo||d.api.progressEvents((({chapter:e,event:t,player:i})=>{const a=i.metadata.chapters_attributes[e]?.video_attributes;if(a){const{length_in_seconds:e}=a;this.videoUuid=this.getChapterVideoId(a),this.chapterName=a.name,25!==t&&50!==t&&75!==t&&100!==t||(this.videoPercentageWatched=`${t}%`,this.videoSecondsWatched=e*(t/100),this.firePbcVideoEvent("custEv_percentComplete",i),100===t&&(this.initialPlayEventFired=!1,t=0))}}),[25,50,75,100]))})),t.on("pause",(()=>{this.liveVideo&&this.heartbeatInterval&&clearInterval(this.heartbeatInterval)})),t.on("playerComplete",(()=>{this.liveVideo&&this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}))}),this.videoUuid)}getChapterVideoId(e){const t=e.thumbnail_urls?.normal;if(!t)return console.warn("Thumbnail URL is undefined for chapter:",e),null;const i=t.split("/")[4];let a=null;return/^-?\d+$/.test(i)&&(a=i),a}generatePlaylistId(){return this.chapters.map((e=>{const t=this.getChapterVideoId(e);return t||"unknown"})).join("_")||"no_videos"}scheduleHeartbeatEvent(e){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval((()=>{this.videoSecondsWatched+=300,this.firePbcVideoEvent("custEv_videoHeartbeat",e)}),3e5)}firePbcVideoEvent(e,t){const i={event:e,videoName:this.chapterName,videoId:this.videoUuid,videoAction:this.videoAction,videoPercentageWatched:this.videoPercentageWatched,videoSecondsWatched:this.videoSecondsWatched,videoPlays:this.videoPlays,videoLoads:this.videoLoads,playerType:this.playerType,chapterIndex:t.status.chapterIndex};"custEv_videoPlaylist"===e&&(i.playlist={playlistId:this.generatePlaylistId(),videos:this.chapters.map(((e,t)=>({position:t+1,videoId:this.getChapterVideoId(e),videoName:e.name})))});const a=new CustomEvent("pbc_video_event",{bubbles:!0,composed:!0,detail:i});this.dispatchEvent(a)}disconnectedCallback(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}sendVidyardApiRequest(){fetch("https://api.vidyard.com/dashboard/v1/players/uuid="+this.videoUuid+"?auth_token=",{method:"GET",headers:{"Content-type":"application/json",Accept:"application/json"}}).then((e=>e.json())).then((e=>{this.chapterId=e.chapters_attributes[0].id,this.playerUuid=e.id})).catch((e=>console.error(e)))}}i(h,{publicProps:{videoUuid:{config:0},liveVideo:{config:0}},fields:["playerList","currentUuid","initialPlayEventFired","initialLoadEventFired","heartbeatInterval","videoAction","videoPlays","videoLoads","videoPercentageWatched","videoSecondsWatched","playerType","chapterId","playerUuid","chapters","chapterName"]});var p=a(h,{tmpl:n,sel:"pbc-vidyard-analytics",apiVersion:59});const u=e=>{const t={};return t.playerType=e.playerType,t.videoName=e.videoName,t.videoId=e.videoId,"custEv_videoLoad"===e.event?(t.videoLoads=e.videoLoads,t.chapterIndex=e.chapterIndex):"custEv_videoPlay"!==e.event&&"custEv_percentComplete"!==e.event&&"custEv_videoHeartbeat"!==e.event||(t.videoPlays=e.videoPlays,"custEv_videoPlay"===e.event&&(t.videoAction=e.videoAction),"custEv_percentComplete"!==e.event&&"custEv_videoHeartbeat"!==e.event||(t.videoSecondsWatched=e.videoSecondsWatched,"custEv_percentComplete"===e.event&&(t.videoPercentageWatched=e.videoPercentageWatched))),t};document.querySelectorAll("[data-blade-id]").forEach((e=>{e.addEventListener("pbc_video_event",(e=>{const t=(e=>{const t=e.detail||e,i=t.target||e.target;let a=t.currentTarget||e.currentTarget;return!a?.dataset?.bladeId&&i&&(a=i.closest("[data-blade-id]")||i?.ownerDocument?.activeElement?.parentElement),{event:t.event,blade:v(v(v({},y(a.dataset)),"custEv_videoPlaylist"===t.event&&{playlist:t.playlist}),"custEv_videoPlaylist"!==t.event&&{video:u(t),type:"video"})}})(e);t?.event&&(e=>{if(!e)return;const t=new CustomEvent("www_track",{bubbles:!0,composed:!0,detail:{event:e.event,blade:e.blade}});document.dispatchEvent(t)})(t)}))}));const y=e=>({id:e.bladeId,name:e.bladeName,position:e.bladePosition,source:e.bladeSource,variant:e.bladeVariant,state:e.bladeState||"rendered"});s("pbc-vidyard-analytics",p);export{p as pbcVidyardAnalytics};
