var p=globalThis.sfdcBase||{};var c={WARN:"warn",INFO:"info",DEBUG:"debug",DEPRECATE:"deprecate"},x="client-libs-debug",O=async(e,...t)=>{let r=sessionStorage.getItem(x),s=r==="mute";if(!t.length||s)return;let o=console,a="trace",n;switch(e){case c.DEPRECATE:n=o[a],t=`${t} has been deprecated. Please update or remove reference`;break;case c.DEBUG:r&&!s&&(n=o[a]);break;case c.INFO:case c.WARN:n=o[e];break}typeof n=="function"&&n(t)};var y="</|[<>()]",C={param:e=>e?e.trim().replace(new RegExp(`${y}|(%3(c|e))`,"gi"),""):"",path:e=>e?encodeURI(decodeURIComponent(e).trim().replace(new RegExp(`${y}|'|"|;|=`,"gi"),"")):""};var E=(e=location.search)=>e.replace("?","").split("&").reduce((t,r)=>{let s=r.split("=").filter(o=>!!o);return t[s[0]]=C.param(s[1]??""),t},{});var z=!!(p.env&&p.env.toLowerCase()==="prod");var _=e=>{let t=localStorage.getItem(e);try{t=JSON.parse(t)}catch{}return t??""};var L="webactls";globalThis.digitalData=globalThis.digitalData||{page:{},user:[{}],localStorage:{..._(L)||{}},util:{}};globalThis.digitalData.timestamp=globalThis.digitalData.timestamp||new Date().getTime();var m=globalThis.digitalData;var I="https://c.salesforce.com",M=globalThis?.cliLibsConfig?.cdnScriptsOrigin||"https://a.sfdcstatic.com",A="/digital/@sfdc-www/clientlibs-web-components",N="v1",j="gdpr.js",G="v1",B="/digital/one-trust/ext";var T={QA:"latest",UAT:"stage",PROD:"stable",DEV:"latest",INT:"stage",HOTFIX:"stable",ONBOARD:"stable"},b="Could not import module URL: ",U=p.env||"",H=U&&T[U]?T[U]:"stable",$={ver:N,path:A,envTag:H},F=(e,t)=>{if(e)try{t={...$,...t};let r=t.verDir||`${t.ver}-${t.envTag}`,s;return e==="iis.min.js"?s=new URL(t.path,I):s=new URL(t.path,M),s.pathname+=`/${[r,e].join("/")}`,s.toString()}catch{}},W=(e,t)=>{let r=F(e,t);return r?import(r).catch(s=>{O(c.WARN,`${b} ${r}`)}):Promise.reject(`${b} ${e}`)},f=W(j,{ver:G,path:B});var k=25,w="|",P="sfdcUtm",g="utm",l="utm_",i="timestamp",R={utm_campaign:"cp",utm_objective:"ob",utm_content:"ct",utm_source:"src",utm_medium:"md",utm_adgroup:"ag",utm_term:"t",utm_matchtype:"mt",utm_country:"cn",utm_language:"l",utm_adused:"ad",d:"d",nc:"nc",[i]:"utc"},J=Object.entries({...R}).reduce((e,[t,r])=>(e[r]=t,e),{});m[g]=m[g]||[];var D=(e,t=!1,r=!1)=>{let s=t?J:R,o=Object.entries(E(e)).reduce((a,[n,d])=>(s[n]&&(d=decodeURIComponent(d),d&&a.push([r?s[n]:n,d])),a),[]);return{rawString:o.map(([a,n])=>`${a}=${encodeURIComponent(n)}`).join("&"),params:Object.fromEntries(o)}},Y=async e=>f.then(t=>t.onGroupActive(t.OT_FUNCTIONAL).then(()=>{if(!e.length)return;let r=e.map(s=>s.toShort()).join(w);localStorage.setItem(P,r)})),S=async()=>{localStorage.removeItem(P),m[g]=[]},K=e=>D(e),v=async()=>{let e=await f;e.onGdprReady.then(()=>e.onConsentUpdate(h))},V=()=>(localStorage.getItem(P)||"").split(w).reduce((e,t)=>{try{t&&e.push(new u(t))}catch{}return e},[]),h=async()=>{if(!await f.then(o=>o.onGdprReady.then(()=>o.isActiveGroup(o.OT_FUNCTIONAL))))return S(),[];let t=await m[g];if(t&&t.length)return t;let r=V();try{let o=new u;r.length>=k&&r.shift(),r.push(o),Y(r)}catch{}let s=r.map(o=>o.toRecord());return m[g]=s,s},u=class extends URL{constructor(t=location.toString()){let r=t.startsWith(l);r&&(t=t.replace(l,"https://")),super(t);let{rawString:s,params:o}=D(this.search,r,r);if(!r&&!s.includes(l))throw Error("Url must contain UTM params");this.url=this.origin+this.pathname,this.search=s,this.driver=o.d||"",this.name_capture=o.nc||"",this.utms=Object.fromEntries(Object.entries(o).filter(([a])=>a.startsWith(l))),this[i]=o[i]||new Date().toISOString(),this.searchParams.set(i,this[i])}toShort(){return[l,this.hostname,this.pathname,`?${D(this.search,!1,!0).rawString}`].join("")}toRecord(){return{landing_page_url:this.url,driver:this.driver,name_capture:this.name_capture,[i]:this[i],...this.utms}}};i;(async()=>h().then(v))();export{u as UtmUrl,h as getUtmHistory,K as parseUtmParams,S as resetUtmHistory};
//# sourceMappingURL=attribution.js.map
